---
title: |
  | The association between crashes and safety-critical events: 
  | synthesized evidence from crash reports and naturalistic driving data among commercial truck drivers
author:
  - name: Miao Cai
    email: miao.cai@slu.edu
    affiliation: SLU
  - name: Mohammad Ali Alamdar Yazdi
    email: mza0052@auburn.edu
    affiliation: JHU
  - name: \mbox{Amir Mehdizadeh}
    email: azm0127@auburn.edu
    affiliation: AU
  - name: Qiong Hu
    email: qzh0011@auburn.edu
    affiliation: AU
  - name: \mbox{Alexander Vinel}
    email: alexander.vinel@auburn.edu
    affiliation: AU
  - name: \mbox{Karen Davis}
    email: davisk4@miamioh.edu
    affiliation: MU
  - name: \mbox{Fadel Megahed}
    email: fmegahed@miamioh.edu
    affiliation: MU
  - name: \mbox{Steven E. Rigdon}
    email: steve.rigdon@slu.edu
    affiliation: SLU
    footnote: Corresponding Author
address:
  - code: SLU
    address: Saint Louis University, Saint Louis, MO, 63108
  - code: JHU
    address: Johns Hopkins University, Baltimore, MD, 21218
  - code: AU
    address: Auburn University, Auburn, AL, 36849
  - code: MU
    address: Miami University, Oxford, OH, 45056
abstract: |
  The past decade has seen continuously increasing traffic safety studies using naturalistic driving data. A few studies have attempted to examine the association between safety incidences that are commonly used in naturalistic driving data and crashes. However, this association has been rarely verified among commercial truck drivers. This paper proposes to examine the association between crashes and four types of safety critical event at the level of drivers.
keywords: truck, naturalistic driving studies, safety critical events, crashes
journal: "Transportation Research Part C"
date: "`r Sys.Date()`"
bibliography: mybibfile.bib
output:
  bookdown::pdf_book:
    base_format: rticles::elsevier_article
    number_sections: true
link-citations: true
linkcolor: blue
geometry: "left=2cm,right=2cm,top=2cm,bottom=2cm"
fig_caption: yes
header-includes:
  - \usepackage{soulutf8}
  - \usepackage{color}
  - \usepackage{float}
  - \usepackage{subcaption}
  - \usepackage{booktabs}
  - \usepackage{lscape}
  - \usepackage{setspace}
  - \usepackage{dcolumn}
  - \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, message=FALSE, fig.align = "center")
```

\newcommand{\blandscape}{\begin{landscape}}
\newcommand{\elandscape}{\end{landscape}}
\doublespacing

Introduction
============

According to the World Health Organization (WHO), road injuries were the eighth leading cause of death globally in 2018 [@who2018]. They claimed a total of 1.35 million lives every year worldwide, with 74% of them being men and boys [@who2018]. Among children and young adults aged five to 29 years old, road traffic injuries are the leading cause of death [@world2018global]. Besides life losses, road injuries also cause up to 50 million non-fatal injuries and around 75.5 million disability-adjusted life years [@staton2016road; @world2018global]. Since around 90% of road traffic deaths and injuries occurred in low- and middle-income countries, the number of road traffic deaths and injuries is expected to be increasing given the rapid motorization of transportation in these countries [@world2018global]. 

Among different vehicles on the road, trucks are highlighted since they are more often associated with severe outcomes such as fatalities [@zheng2018commercial]. The Federal Motor Carrier Safety Administration (FMCSA) in the United States reported that 27% of working-zone fatal crashes in 2016 involve trucks [@fmcsareport2018]. In addition, 4564 lives were claimed out of 4079 truck- or bus-related crashes in 2016, which means an average of 1.12 people were killed in truck- or bus-related crashes [@fmcsafacts2016]. The catastrophic consequences of truck-related crashes attribute to the characteristics of trucks and their drivers: long routes, intensive schedule, massive size and weight, and potentially hazardous cargoes [@hanowski2005driver; @chen2014impacts; @chen2016influence]. Since costs of truck crashes are dramatic and a public concern, truck crash prediction has been a widely studied topic in traffic safety research.

A substantial amount of studies have been published on road crash prediction. These studies primarily focus on using driver characteristics, traffic, weather, and others to predict the likelihood, frequency, or severity of crashes based on  police report data [@lord2010statistical; @wang2013effect; @savolainen2011statistical; @wang2013effect; @roshandel2015impact]. However, truck crash data, such as the Large Truck Crash Causation Study  [@starnes2006large], are subject to several limitations since they ultimately trace back to retrospective police reports [@stern2019data]. Firstly, truck crash data are extremely sparse compared to non-crashes. @fmcsareport2017 estimated that fatalities associated with large truck and bus in 2017 were 0.156 per million traveled miles. In the situation of extremely rare events, it is difficult to make statistically significant and valid conclusions [@guo2010near; @theofilatos2018impact]. Second, truck crash data reported by drivers and police are subject to recall bias and information bias. The reports cannot accurately record the real-time traffic and weather variables prior to the accidents.  Moreover, drivers at fault tend not to report or underreport critical factors such as distraction or cell phone use, in order to avoid associated penalties [@dingus2011estimating; @stern2019data].

Given the limitations in truck crashes data mentioned above, there is a growing trend of using a naturalistic driving Studies (NDSs) to understand and enhance traffic safety. Compared with traditional retrospective and aggregated crash data, NDS proactively collect high-frequency kinematic and Global Positioning System (GPS) data from a suite of vehicle sensors and other unobtrusively placed devices during regular day-to-day activities [@neale2005overview; @guo2013individual; @guo2019statistical]. The NDS data are vehicle-based instead of roadway location- or intersection-based, so they are superior in estimating the rate or risk of safety events compared to roadway-based case-control studies. More importantly, NDS has the power of providing precise real-time data on kinematic events, such as acceleration or deceleration over a pre-specified threshold, which provide the opportunity to investigate the short period prior to crashes or safety events with information bias or reporting bias [@guo2010near]. As NDS data are collected at an interval of typically 1 to 5 minutes without obtrusive instrumentation or instruction, the amount of NDS data are generally enormous, which provides both an opportunity and a challenge for statistical inference.

The NDS data collection design does not change the rare-event nature of vehicle crashes. To avoid this rare-event issue, researchers proposed using near-crashes or safety-critical events (SCEs) in combination with crashes [@dingus2006100]. Detected from dynamic kinematic events, SCEs or near-misses are special types of accident precursors that have all features of accidents, with the exception that potentially catastrophic outcomes were avoided by last-second evasive maneuver [@dingus2011estimating; @saleh2013accident]. These SCEs are around 10 to 15 times as frequent as crashes, and past studies suggested that they were indicative of crashes [@guo2010near]. SCEs provide an alternative to study traffic safety, without having to observe for a prohibitively long time to have a sufficiently large amount of crashes [@guo2019statistical]. However, there are limited studies that quantify whether SCEs are associated with crashes among trucks. The purpose of this paper is to examine the association between crashes and SCEs using naturalistic commercial truck driving data. Specifically, four SCEs are considered in this study: headways, hard brakes, collision mitigation, and rolling stability.


Literature review
=================
There has been a considerable number of studies evaluating the association between crashes and surrogate measures since the 1980s, with the general approach being estimating the conversion factor between the two types of events [@evans1982accident; @evans1983risky; @cooper1984experience; @risser1985behavior; @hyden1987development]. This topic has become a crucial issue as more naturalistic driving data sets are available to researchers in the recent decade. The first large-scale NDS was The 100-Car Naturalistic Driving study, including 102 drivers in North Virginia, the United States [@neale2005overview]. The study continuously and naturalistically  recorded driving data for 102 participating drivers for one year, resulting in around two million vehicle miles and over 40,000 hours of driving data. Over the study period, 69 crashes, 761 near-crashes, and 8,295 incidents were collected. Based on this 100-Car study, @dingus2006100 found that hard braking events were significantly associated with collisions and near-crashes. Since the number of near-crashes and incidents were significantly larger than crashes, they proposed using near-crashes and incidents as surrogates of crashes. 

The rationale for using near-crashes and SCEs as surrogates for crashes is Heinrich's Triangle, which assumes that less severe events are more frequent than severe events, and the frequency of severe events can diminish as that of less severe events decreases [@guo2019statistical]. The latter assumption can be quantitatively tested using crash and naturalistic driving data, but verifying the former assumption is challenging since the causal mechanism is complex and unknown [@guo2010near]. Applying SCEs in traffic safety studies to Heinrich's Triangle can substantially increase the study sample size and may potentially enable the estimation of driving risk. However, a crucial question prior to the usage of SCEs in naturalistic studies is whether they are good surrogates of traffic crashes.

@guo2010near proposed two critical principles for using near crashes as surrogates for crashes: 1) similar or the same causal mechanisms between crashes and surrogates, 2) a strong association between the frequency of surrogates and crashes. Based on the 100-car database, they investigated the two principles using a sequential factor analysis, a Poisson regression, and a sensitivity analysis. The study concluded that using near crashes as surrogates for crashes will lead to conservative risk estimates but significantly reduce the variance of estimation. They suggested that using near crashes as surrogates in small-scale studies will be informative for evaluating the risk of crashes.

@gordon2011analysis conducted a preliminary study to validate surrogates for road-departure crashes by spatially merging road geometry, average traffic, crashes, and naturalistic driving data. Bayesian seemingly unrelated Poisson models estimated with weighted least squares were used to examine whether the same sets of predictor variables have the same effects on crashes and surrogates. The found that time to edge crossing and lane-departure warning were two useful surrogates for crashes on rural nonfreeway roads, while lane deviation was a poor surrogate for lane-departure crashes.

@simons2012elevated examined whether elevated gravitational-force predicts crashes and near crashes among 42 newly licensed teenage drivers in Virginia. The study used the Naturalistic Teenage Driving Study that followed the recruited drivers for 18 months. A logistic regression estimated with generalized estimating equations to account for the within-subject correlation among different months. It was found that the rate of elevated gravitational-force events was positively associated with the rate of crashes and near-crashes (odds ratio = 1.07, 95% confidence interval: 1.02, 1.12), with the area under curve (AUC) value of 0.76.

@wu2012crashes proposed a conceptual framework to estimate the crash-to-surrogate ratio $\pi$ and used the 100-Car study to test the framework. The study found that the conditional probability of a crash was increased by 24 times with a lateral acceleration more than 0.7 g, but the probability was decreased by other factors such as the event occurring in daylight and dry pavement. A later study by @wu2013defining developed diagnostic procedures to screen crashes and near misses under naturalistic study settings. The study applied the 100-Car Natural Driving Study on the proposed framework and identified three conditions to define surrogate events: 1) maximum lateral acceleration difference of no smaller than 0.4 g, 2) non-intersection related, and 3) maximum lateral acceleration difference no smaller than 0.9 per event or between 0.8 and 0.9 g during night time.

@guo2013individual attempted to identify risk factors of driving at drivers level and predict high-risk drivers based on the 100-Car study. The study used a negative binomial (NB) regression to examine the potential four risk factors of crashes and near-crashes. They used a K-mean clustering to classify the drivers into high-, moderate-, and low-risk groups based on crash and near-crash rates, and applied two logistic regressions to predict high- or moderate-risk drivers. The results confirmed that critical-incident event rates were significantly associated with individual driving risk. The two logistic regressions achieved AUC values of 0.938 and 0.93. They also highlighted that it was a first-step study and more studies with larger and representative data were needed to confirm the association. A similar study by @wu2014using also used the 100-Car study. This study used a Bayesian multivariate Poisson log-normal model to simultaneously account for crash frequency and severity. They also found a significant positive association between crashes, near crashes, and crash-relevant incidents.

@pande2017preliminary used linear referencing to link Global Positioning System (GPS) data with roadway features on 39 segments of Highway 101 in California. NB models and random-effects NB models account for segment-specific variance were used to investigate the relationship between historic crashes and hard braking. It was found that the freeway segments with high hard braking rates also had higher long-term crash rates, although the other three explanatory variables, average daily traffic, the presence of horizontal curvature and auxiliary lanes were not statistically significant. 

@gitelman2018exploring used in-vehicle data recorders (IVDR) data collected on 3500 segments of interurban roads in Israel to examine the association between two types of safety-related events (braking and speed alert) and crashes on different road types. NB models were applied to account for the over-dispersion in the data, and they also included a number of road infrastructure characteristics as covariates. The number of braking events was found to be positively associated with injury crashes on single- and dual-carriageway roads while the association was not significant on freeways. In contrast, they yield counterintuitive results that speed alert events (overspeed) were consistently and negatively associated with injury crashes on all road types. It was suggested that a speed alert event were not a good surrogate for crashes, possibly due to its rough definition.

Some researchers have been skeptical of NDS. For example, @knipling2015naturalistic challenged the validity of using naturalistic driving data and SCEs by stating that the purpose of traffic safety studies is to identify causes of crash harm and develop interventions. Crash harm is defined as property damage, injury, income lost, and all other consequences of different severities [@zaloshnja2007unit]. NDS often use SCEs as surrogates of crashes, but very few or no crashes are involved, let alone human harm. Therefore, @knipling2015naturalistic argues that SCEs are not an appropriate part of the Heinrich's Triangle and researchers generally cannot derive valid quantitative conclusions on causations of harm based on NDS datasets. Another study by @knipling2017threats specifically targeted Hour-of-Service (HOS) rule research, such as @blanco2011impact and @hanowski2008analysis, and relevant policy revisions among commercial truck drivers. He argued that HOS studies with a quasi-experiment design were subject to confounding variables, so these studies are limited in demonstrating a causal relationship between HOS and safety outcomes. The paper also argued that NDS lacked external validity since no large truck NDS had examined the causal link between crashes and SCEs. Lastly, the construct validity was doubted as the relationship between driver fatigue, HOS, and SCEs had not been validated.

In summary, the association between vehicle crashes and crash surrogates needs to be verified before valid conclusions can be reached based on crash surrogate measures in NDS. No consistent conclusion has been reached on the association between the number of crashes and surrogates in traffic safety studies [@guo2019statistical]. There are three gaps in previous NDS studies on the association between crashes and SCEs: 1) the number of studies examined this association among commercial motor vehicles is limited, despite two separate NDS data sets (the Drowsy Driver Warning System Field Operation Test and the Naturalistic Truck Driving Study) have been sponsored by the Federal Motor Carrier Safety Administration [@hickman2018synthetic], 2) the association between different types of SCEs and the risk of crashes has not been investigated, 3) the data sources are limited to the widely available 100-Car study with a relatively small number of drivers.

Methodology
===========
Data source
-----------
During the study period, a data acquisition system (DAS) was installed in each truck in a large commercial trucking company from April 1st, 2015 to March 31st, 2016. The DAS intermittently collected real-time driving ping data every 1 to 5 minutes, including the exact time of the record (year, month, day, hour, minute, and second), latitude and longitude (specific to five decimal places), speed, drivers' anonymized unique identification numbers, and heading. In total, 1,494,678,173 pings were collected from 31,881 commercial truck drivers between and provided to the research team. 

In the meanwhile, a total of $480,331$ SCEs were recorded at the time when pre-specified kinematic thresholds were triggered while driving during the study period. The exact date, time, location, speed difference, driver, and type of SCEs were collected for each SCE. This data source included 184,773 headways, 231,101 hard brakes, 55,345 collision mitigation, and 9,112 rolling stability. Non-kinematic definitions of the four types of SCEs are:

- *Headway*: the headway to a lead vehicle is closer than a preset threshold value.
- *Hard brake*: the speed decrease within unit time is higher than a preset threshold value.
- *Collision mitigation*: an imminent collision with a forward slower moving or standing vehicle or object.
- *Rolling stability*:  potential roll-over and loss-of-control situations in various road or weather conditions (dry, wet, snow and ice-covered pavement).

<!--
- headway: https://link.springer.com/book/10.1007%2F978-0-387-44409-3
- Collision mitigation: Provides audible and visual alerts to the driver and applies the brakes when the system determines a collision with forward vehicle is imminent,
- Rolling stability: https://www.bendix.com/media/documents/products_1/acb_1/wingmanadvanced/bw2855bxwingmanadvancedbrochurefinal32411.pdf
-->

Another crash data set that included driver, state, city, report time, fatalities, injuries, were collected by retrospective reports. In total, 35,008 crashes, 241 injuries, and 22 fatalities were reported in this table. All data were de-identified prior to the research team had access to them. The study protocol was approved by the Institutional Review Board of Saint Louis University.

Data aggregation
----------------

Since the original ping data were huge and difficult to interpret with regard to the routing, we aggregated them to trips using the approach adopted in @pande2017preliminary.
A trip is defined as a continuous period of driving without more than 30 minutes' stop. In practice, we sorted the original ping data according to date and time for each driver. Then, if the ping speed data showed that the truck was not moving (the speed of the ping equals zero) for more than 30 minutes, the ping data were separated into two different trips. As demonstrated in Figure \@ref(fig:pingshifttrip), the x-axis shows the data and time of pings and the y-axis presents the speed of the ping (miles per hour, MPH). Whenever the truck stopped for at least 30 minutes, the pings were separated into different trips, indicated by the purple arrows in the bottom. The trip time was then calculated by taking the difference between the trip end time and start time. The traveled distance within a trip was calculated in three steps: 1) sort the ping data according to driver, date, and time, 2) compute the distance between each temporally nearest two ping locations for each driver using the haversine method, which assumes a spherical earth and ignore ellipsoidal effects [@sinnott1984virtues], 3) sum up all the distance travelled within a trip for each driver. This algorithm aggregated the original ping data into $18,759,300$ trips, with a total of $2,323,007,042$ miles travelled in $65,706,497$ hours. The median distance of a trip is 2.61 hours and the median of miles per trip was $77.06$ miles.

```{r pingshifttrip, out.width='\\textwidth', fig.cap='Data aggregation from ping data to trips for a sample of a commercial NDS data set.'}
knitr::include_graphics("figs/fig_ping_trip_real.pdf")
```


Statistical models
------------------
Since the number of crashes is a count variable, which is strictly a non-negative integer, Bayesian NB models are considered for modeling it in this study. Compared with Poisson model commonly used for modeling count outcomes, NB model can adjust for the variance independently from its mean, which handles potential overdispersion or underdispersion issues in the data. Let $Y_i$ denote the number of the outcome variable (crashes, injuries, and fatalities) over a distance of $T_i$ miles for the $i$th driver. We assume that $Y_i$ has a NB distribution with the mean parameter $\mu_i$ and auxiliary parameter $\phi$. The corresponding probability mass function of $Y_i$ is:

$$P(Y_i|\mu, \phi) = \binom{y + \phi - 1}{y}\bigg(\frac{\mu}{\mu + \phi}\bigg)^y\bigg(\frac{\phi}{\mu + \phi}\bigg)^\phi$$

The mean and variance of $Y_i$ are $E[Y_i] = \mu$ and $V(Y_i) = \mu + \frac{\mu^2}{\phi}$. The inverse of $\phi$ controls the overdispersion, which is scaled by $\mu^2$. By assuming that the number of SCEs per 10,000 miles has a mathematically multiplicative effect on the rate of crashes ($\mu_i$), we have the following log-linear NB regression:

$$
\begin{aligned}
Y_i & \sim \text{NB}(T_i\cdot\mu_i, \; \phi)\\
\log\mu_i & = \beta_0 + \beta_1x_{1i} + \beta_2x_{2i} + \cdots + \beta_Kx_{Ki}\\
\beta_0 , \beta_1, \cdots, \beta_K & \sim \text{Normal}(0, 10^2)\\
\phi & \sim \text{Exponential}(1)
\end{aligned}
$$

Where $\beta_0$ is the intercept, $\beta_k, k = 1, 2, \cdots, K$ is the coefficient of the $k$-th predictor variable $x_m$. Our main variables of interest were the rates of all SCEs (the number of SCEs per 10,000 miles) and the rates of four different types of SCEs, including headways, hard brakes, collision mitigation, and rolling stability. The covariates were average speed, driver's age and gender, business units, and driver types. Business units included Dedicated Contract Services (DSC), Intermodal (ITM), and Final Mile Services (FMS), with DSC being the reference group. Driver types included local (LOC), regional (REG), and over-the-road (OTR), with LOC being the reference group. Since the traveling distance differed substantially among the drivers, we used the total miles driven as an offset term ($T_i$) in the model to account for this difference. 

As we do not have much prior knowledge on the parameters, weakly informative priors $N(0, 10^2)$ were given to the intercept $\beta_0$ and slopes $\beta_1, \beta_2, \cdots, \beta_K$, and an exponential prior with mean parameter 1 was given to the overdispersion parameter $\phi$ which is restricted to be positive. The posterior mean and 95% credible intervals (CIs) of the incidence rate ratios (IRRs) were reported, which is $\exp(\beta)$. The interpretation of this NB model is: as the number of SCEs per 10,000 miles increases by one unit, the number of crashes per mile will be multiplied by $\exp(\beta)$ times. 

We used Pareto smoothed importance-sampling leave-one-out (PSIS-LOO) cross-validation (CV) to check the goodness-of-fit of and compare different models [@vehtari2017practical; @vehtari2015pareto]. Instead of exact CV that refits the model with different subsamples, the PSIS-LOO uses fast, efficient, and stable importance sampling weights to approximate leave-one-out CV [@gelfand1992model; @gelfand1996model]. It estimates the expected log predicted density (ELPD), estimate number of parameters, and the LOO Information Criterion (LOOIC) for a new dataset. Compared with other statistics such as Widely Applicable Information Criterion (WAIC), Deviance information criterion (DIC), and other variants [@spiegelhalter2002bayesian; @watanabe2010asymptotic], PSIS-LOO has the advantage of fast and stable computation. Apart from PSIS-LOO, we also used posterior predictive checks to examine the prediction accuracy [@gelman2013bayesian].

All data cleaning, statistical modeling, and visualization were performed in the statistical computing environment `R 3.6.0` [@team2013r]. The haversine method distance was computed using the `distHaversine()` function in `geosphere` package [@geospherepackage]. The Bayesian NB model was conducted using the `stan_glm()` function in `rstanarm` package [@rstanarmpackage]. The PSIS-LOO statistics were computed using the `loo()` function in `loo` package [@loopackage].


Results
=======
Sample description
------------------
Since there were tremendous amount of ping data in the original ping data set and plotting them all will overwhelm the entire map, we rounded all latitudes and longitudes to two decimal places (as large as normal-size parking lot) and only displayed locations with more than 50 pings. Figure \@ref(fig:pointpattern) shows the geographical point patterns of active pings (Figure \@ref(fig:pointpatternA)) and inactive pings (Figure \@ref(fig:pointpatternB)). The red dots are the locations with at least 50 actively moving pings and blue dots are the locations with at least 50 stopping pings, with deeper color suggesting higher number of pings. The background grey lines are the major roads in the United States [@usgs] and the solid black lines are state boundaries. The geographical point patterns suggest that most of the trucking transportation is in middle and eastern parts, as well as California. The active and inactive pings are mostly consistent, but active pings are much more concentrated on the major Midwest roads than inactive pings.

Among all the sample 31,881 drivers, 29,296 (91.89%) were male, 1,585 (4.97%) were female, and 1,000 (3.14%) were unspecified. The mean age of the drivers were 44.48 years with a standard deviation of 11.72 years. The range of the ages were from 20 to 82 years. With regard to business units, 16,182 (50.76%) drivers served in the DCS unit, in which the drivers work for a single customer and drive on familiar routes. 9,780 (30.68%) drivers were in ITM, where the drivers conduct traditional truck driving duties and transport freight containers from rail yards to local locations. 5,919 (18.57%) drivers were in FMS and made deliveries to customer locations. As for driver types, 13,399 (42.03%) were LOC drivers who transport freight within 200 miles and return home on the same day. 15,729 (49.34%) were REG drivers, who move freight within a region or interstate and return home on a weekly or bi-weekly basis. Only 2,753 (8.64%) were OTR drivers, who deliver and pick up freight throughout the country. OTR drivers need to be on the road for more than two weeks and then consider taking days off or continue working.

```{r table1, eval=FALSE}
pacman::p_load(summarytools)
d = data.table::fread("data/Aim1_crash_SCE.csv")
d[,freq(gender)] # gender
d[,descr(age)]
d[,freq(bus_unit)]
d[,freq(d_type)]
```

```{=latex}
\begin{figure}%[htb]
    \centering
    \begin{subfigure}[a]{\textwidth}
        \centering
        \includegraphics[width=\linewidth]{figs/map_active_grey_50.png}%
        \caption{Active pings}
        \label{fig:pointpatternA}
    \end{subfigure}
    \vskip\baselineskip
    \begin{subfigure}[b]{\textwidth}
        \centering
        \includegraphics[width=\linewidth]{figs/map_stop_grey_50.png}%
        \caption{Inactive pings}
        \label{fig:pointpatternB}
    \end{subfigure}
    \caption{Geographical point patterns of active and inactive pings in a large commercial NDS data set.}
    \label{fig:pointpattern}
\end{figure}
```

Pooled Bayesian NB models for SCEs
------------------------
Table \@ref(tab:pooled) shows the estimates of posterior IRRs and their CIs in the Bayesian NB models for all the sample drivers. We conducted the model for all SCEs combined (Pooled model), four types of SCEs in one model (Four SCEs) and separately in four models (columns 4-7). All the IRRs of SCEs in the six models were greater than one and none of the associated CIs included one, indicating strong evidence that the rate of SCEs were positive associated with the rate of crashes. Specifically, as the number of headways, hard brakes, rolling stability, and collision mitigation per 10,000 miles increased by one unit, the number of crashes per mile increase by 0.033, 0.081, 0.504, and 0.222 times controlling for other covariates.

Bayesian NB models stratified by business units and driver types
--------------------------------------------------------------
Since the driving behaviors vary significantly among different business units and driver types, Bayesian NB models were conducted among drivers in different business units and types, and the results are shown in Table \@ref(tab:stratified). The posterior IRRs and CIs of four SCEs are consistents with those in Table \@ref(tab:pooled). All four type of SCEs were positively associated with the number of crashes per mile. None of the CIs included the point one except for headways in the DCS-OTR unit. Among the four types of SCEs, rolling stability had the highest IRRs, followed by collision mitigation, hard brake, and headway.

Bayesian NB models for injuries and fatalities
----------------------------------------------
Table \@ref(tab:injuries) presents the results of Bayesian NB models for the number of injuries and the number of fatalities. Compared with the models for the number of crashes, the result are less conclusive. A unit increase in the number of any type of SCEs per 10,000 mile was associated with 0.087 times (95% CI: 0.048-0.136) increase in the number of injuries per mile. When stratified into four different types of SCEs, all of the 95% CIs of IRRs included one, although the posterior means were all positive. In the two models using the number of fatalities as the outcome variable, all of the 95% CIs of IRRs included one and the CIs were very wide, which suggested insufficient data in the number of injuries and fatalities to make valid inference.


\blandscape
```{r message=FALSE}
pacman::p_load(huxtable, broom, dplyr, stringr)

z = readRDS("fit/a0_pooled_fit.rds")

pad_est = function(x, digits = 3, exponentiate = TRUE){
  if(exponentiate){
    z = round(x, digits)
    z = ifelse(z == 0, "0.000", str_pad(z, digits + 2, "right", "0"))
  }else{
    z = ifelse(x < 0,
             round(x, digits) %>% 
               str_pad(digits + 3, "right", "0"),
             round(x, digits) %>% 
               str_pad(digits + 2, "right", "0") %>% 
               str_pad(digits + 3, "left", ' '))
  }
  return(z)
}

getfit = function(fit, model_name = "model_estimate", digits = 3, exponentiate = TRUE){
  z = tidy(fit, intervals = TRUE, prob = 0.95) %>% 
    {if(exponentiate == TRUE){
      mutate(.,
             estimate = exp(estimate),
             lower = exp(lower),
             upper = exp(upper))
      }else{
        .
      }} %>% 
    mutate(estimate = pad_est(estimate),
           ci = paste0("(", pad_est(lower), ", ", 
                       pad_est(upper), ")")) %>% 
    mutate(zz = paste0(estimate, " ", ci)) %>% 
    select(term, zz) %>% 
    magrittr::set_colnames(c("variables", model_name))
  return(z)
}

getloo = function(fit){
  d = fit$estimates %>% 
    as.data.frame() %>% 
    mutate(Estimate = round(Estimate, 1),
           SE = round(SE, 1)) %>% 
    mutate(values = paste0(Estimate, " (", SE, ")")) %>% 
    select(values)
  return(rbind(length(fit$diagnostics$pareto_k), 
               d))
}

tab_fit = getfit(z[[1]], "Pooled model") %>% 
  full_join(getfit(z[[2]], "Four SCEs")) %>% 
  full_join(getfit(z[[3]], "Headways")) %>% 
  full_join(getfit(z[[4]], "Hard brakes")) %>% 
  full_join(getfit(z[[5]], "Rolling stability")) %>% 
  full_join(getfit(z[[6]], "Collision mitigation")) %>% 
  arrange(match(variables, 
                c("sce_N", "sce_HW", "sce_HB", "sce_RS", "sce_CM",
                  "age", "ping_speed", "genderM", "genderU", "(Intercept)"))) %>% 
  mutate(variables = 
           recode(variables,
                  "sce_N" = "All SCEs",
                  "sce_HW" = "Headways", 
                  "sce_HB" = "Hard brakes", 
                  "sce_RS" = "Rolling stability", 
                  "sce_CM" = "Collision mitigation",
                  "age" = "Age",
                  "ping_speed" = "Mean speed",
                  "genderM" = "Gender: male",
                  "genderU" = "Gender: unknown",
                  "bus_unitJBI00" = "Business unit: ITM", 
                  "bus_unitVAN00" = "Businees unit: FMS", 
                  "d_typeOTR" = "Type: OTR", 
                  "d_typeREG" = "Type: REG", 
                  " Intercept " = "(Intercept)")) %>% 
  add_row(variables = "Fit statistics: ")

tab_loo = data.frame(c("sample size", "elpd_loo", "p_loo", "looic")) %>% 
  cbind(getloo(z[[7]])) %>% 
  cbind(getloo(z[[8]])) %>% 
  cbind(getloo(z[[9]])) %>% 
  cbind(getloo(z[[10]])) %>% 
  cbind(getloo(z[[11]])) %>% 
  cbind(getloo(z[[12]])) %>% 
  magrittr::set_colnames(names(tab_fit))
```

```{r results='asis', eval=T}
capture.output({
  stargazer::stargazer(rbind(tab_fit, tab_loo), 
                       summary=FALSE, rownames=FALSE,
                       align=TRUE, float = TRUE, table.placement = '!htbp',
                       title = "NB regressions with the rate of SCEs predicting crashes",
                       font.size = "small",
                       single.row=FALSE, header=FALSE,
                       notes="The SCEs were measured as the number of events per 10,000 miles driven. IRRs and associated 95\\% credible intervals were reported.",
                       label="tab:pooled")
  }) %>% 
  gsub("\\begin{tabular}","\\resizebox{0.8\\paperheight}{!}{\\begin{tabular}", ., fixed=T) %>% 
  gsub("\\end{tabular}","\\end{tabular}}", ., fixed=T) %>% 
  cat()
```

```{r}
pacman::p_load(purrr)
sub_files = list.files("fit", full.names = TRUE, pattern = ".{3}00.{3}.rds")
driver_comb = list.files("fit", pattern = ".{3}00.{3}.rds") %>% 
  gsub(".rds", "", .) %>% 
  gsub("00", "-", .)

fit_list = list()
for (i in seq_along(sub_files)) {
  fit_list[[i]] = readRDS(sub_files[i]) %>% 
  .[[2]] %>% 
  getfit()
}

tab_fit1 = fit_list %>% 
  purrr::reduce(full_join, by = "variables") %>% 
  magrittr::set_colnames(c("variables", driver_comb)) %>%
  arrange(match(variables, 
                c("sce_N", "sce_HW", "sce_HB", "sce_RS", "sce_CM",
                  "age", "ping_speed", "genderM", "genderU",
                  "(Intercept)"))) %>% 
  mutate(variables = 
           recode(variables,
                  "sce_HW" = "Headways", 
                  "sce_HB" = "Hard brakes", 
                  "sce_RS" = "Rolling stability", 
                  "sce_CM" = "Collision mitigation",
                  "age" = "Age",
                  "ping_speed" = "Mean speed",
                  "genderM" = "Gender: male",
                  "genderU" = "Gender: unknown",
                  "bus_unitJBI00" = "Business unit: ITM", 
                  "bus_unitVAN00" = "Businees unit: FMS", 
                  "d_typeOTR" = "Type: OTR", 
                  "d_typeREG" = "Type: REG", 
                  " Intercept " = "(Intercept)")) %>% 
  add_row(variables = "Fit statistics: ") 
names(tab_fit1) %<>% 
  stringr::str_replace_all(., "JBI", "ITM") %>%
  stringr::str_replace_all(., "VAN", "FMS")

loo_list = list()
for (i in seq_along(sub_files)) {
  loo_list[[i]] = readRDS(sub_files[i]) %>% 
  .[[8]] %>% 
  getloo()
}

tab_loo1 = data.frame(c("sample size", "elpd_loo", "p_loo", "looic")) %>% 
  cbind(loo_list[[1]]) %>% 
  cbind(loo_list[[2]]) %>%
  cbind(loo_list[[3]]) %>%
  cbind(loo_list[[4]]) %>%
  cbind(loo_list[[5]]) %>%
  cbind(loo_list[[6]]) %>%
  cbind(loo_list[[7]]) %>%
  magrittr::set_colnames(names(tab_fit1))
```

```{r results='asis', eval=TRUE}
  capture.output({
    stargazer::stargazer(rbind(tab_fit1, tab_loo1), 
                       summary=FALSE, rownames=FALSE,
                       align=TRUE, float = TRUE, table.placement = '!htbp',
                       title = "NB regressions with the rate of SCEs predicting crashes, stratified by business units and driver types",
                       font.size = "small",
                       single.row=FALSE, 
                       header=FALSE,
                       notes="The SCEs were measured as the number of events per 10,000 miles driven. IRR and associated 95\\% credible intervals were reported.",
                       label="tab:stratified")
  }) %>% 
  gsub("\\begin{tabular}","\\resizebox{0.8\\paperheight}{!}{\\begin{tabular}", ., fixed=T) %>% 
  gsub("\\end{tabular}","\\end{tabular}}", ., fixed=T) %>% 
  cat()
```
\elandscape

```{r}
inj = readRDS("fit/injury_fatality_fit.rds")
inj = readRDS("fit/injury_fatality_fit.rds")

tab_fit = getfit(inj[[1]], "Injuries: pooled") %>% 
  full_join(getfit(inj[[2]], "Injuries: four SCEs")) %>% 
  full_join(getfit(inj[[3]], "Fatalities: pooled")) %>% 
  full_join(getfit(inj[[4]], "Fatalities: four SCEs")) %>% 
  mutate(variables = gsub("^b_", "", variables)) %>% 
  filter(!(variables %in% c("shape", "lp__"))) %>% 
  arrange(match(variables, 
                c("sce_N", "sce_HW", "sce_HB", "sce_RS", "sce_CM",
                  "age", "ping_speed", "genderM", "genderU", 
                  "bus_unitJBI00", "bus_unitVAN00", 
                  "d_typeOTR", "d_typeREG", " Intercept "))) %>% 
  mutate(variables = 
           recode(variables,
                  "sce_N" = "All SCEs",
                  "sce_HW" = "Headways", 
                  "sce_HB" = "Hard brakes", 
                  "sce_RS" = "Rolling stability", 
                  "sce_CM" = "Collision mitigation",
                  "age" = "Age",
                  "ping_speed" = "Mean speed",
                  "genderM" = "Gender: male",
                  "genderU" = "Gender: unknown",
                  "bus_unitJBI00" = "Business unit: ITM", 
                  "bus_unitVAN00" = "Businees unit: FMS", 
                  "d_typeOTR" = "Type: OTR", 
                  "d_typeREG" = "Type: REG", 
                  " Intercept " = "(Intercept)")) %>% 
  add_row(variables = "Fit statistics: ")

tab_loo = data.frame(c("sample size", "elpd_loo", "p_loo", "looic")) %>% 
  cbind(getloo(inj[[5]])) %>% 
  cbind(getloo(inj[[6]])) %>% 
  cbind(getloo(inj[[7]])) %>% 
  cbind(getloo(inj[[8]])) %>% 
  magrittr::set_colnames(names(tab_fit))
```

```{r results='asis', eval=TRUE}
capture.output({
  stargazer::stargazer(rbind(tab_fit, tab_loo), 
                       summary=FALSE, rownames=FALSE,
                       align=TRUE,  float = TRUE, table.placement = '!htbp',
                       title = "NB regressions with the rate of SCEs predicting crashes",
                       font.size = "small",
                       single.row=FALSE, header=FALSE,
                       notes="The SCEs were measured as the number of events per 10,000 miles driven. IRR and associated 95\\% credible intervals were reported.",
                       label="tab:injuries")
  }) %>% 
  gsub("\\begin{tabular}","\\resizebox{\\textwidth}{!}{\\begin{tabular}", ., fixed=T) %>% 
  gsub("\\end{tabular}","\\end{tabular}}", ., fixed=T) %>% 
  cat()
```

```{r plotcrashSCE, out.width='\\textwidth', fig.cap='crude rates of crashes and SCEs'}
knitr::include_graphics("figs/crash_SCE.jpeg")
```

```{r plotcrashCOV, out.width='\\textwidth', fig.cap='crude rates of crashes and other variables'}
knitr::include_graphics("figs/other_covariate.jpeg")
```

Diagnostics statistics and model selection
------------------------------------------
All the models have Pareto $k$ diagnostic statistics of less than 0.7 and the estimated effective number of parameters `p_loo` in Tables \@ref(tab:pooled), \@ref(tab:stratified), \@ref(tab:injuries) were similar to the total number of parameters in the models, suggesting reasonable specified models given the large number of observations in this study [@vehtari2017practical; @vehtari2015pareto]. The LOOIC in the tables can be used to compare different models, with lower values indicating better models. In Table \@ref(tab:pooled), the "Four SCEs" model has the lowest LOOIC (79,540.5) across the six models, although the standard errors in the bracket suggested that the "Four SCEs" model was not significantly better than the "Pooled" model.

In addition, we also checked the quality of model fit by comparing the observed data to 100 replicated datasets generated from the posterior parameters distributions [@gelman2006data]. For each simulated dataset, we computed the proportion of zero crashes and compared them to the observed proportion in the original data. Figure \@ref(fig:loopooled) and \@ref(fig:loostratified) present the posterior predictive check for models in Table \@ref(tab:pooled) and \@ref(tab:stratified). The black solid vertical lines is the observed proportion of zero crashes in study data while the light blue histograms show the distribution of proportion of zero crashes in the 100 simulated data sets generated from the posterior parameters distributions. Although the observed proportion was away from the distribution of proportions in simulated datasets in Figure \@ref(fig:loopooled), they were very close (less than 1.5%). By contrast, the observed proportion of zero crashes located almost at the center of simulated distributions in Figure \@ref(fig:loostratified), which suggested better prediction and model fit than those in Figure \@ref(fig:loopooled).
  

```{r loopooled, out.width='\\textwidth', fig.cap='PPC with zero count test statistic for Bayesian negative binomial models for all drivers'}
knitr::include_graphics("figs/loo_pooled.pdf")
```

```{r loostratified, out.width='\\textwidth', fig.cap='PPC with zero count test statistic for Bayesian negative binomial models, stratified by business unit and driver types'}
knitr::include_graphics("figs/loo_stratified.pdf")
```

Discussion
==========

In line with previous studies on the association between crashes and SCE in NDS [@guo2010near; @gordon2011analysis; @simons2012elevated; @wu2012crashes; @guo2013individual; @pande2017preliminary; @gitelman2018exploring], this study found a positive association between the rate of SCEs and the rate of crashes.

This study has several limitations. 

- We do not have the exact time of crashes.
- The number of crashes may be underreported.
- Insufficient data in injuries and fatalities.
- no traffic or weather data.

Summary and conclusion
======================



Acknowledgement {-}
===============

This research was supported by the National Science Foundation.

References {#references .unnumbered}
==========
