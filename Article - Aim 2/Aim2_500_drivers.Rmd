---
title: | 
  | Modeling safety-critical events using trucking naturalistic driving data: 
  | A generalizable framework for data aggregation, fusion, and statistical modeling
author:
  - name: Miao Cai
    email: miao.cai@slu.edu
    affiliation: SLU
  - name: Mohammad Ali Alamdar Yazdi
    email: yazdi@jhu.edu
    affiliation: JHU
  - name: \mbox{Amir Mehdizadeh}
    email: azm0127@auburn.edu
    affiliation: AU
  - name: Qiong Hu
    email: qzh0011@auburn.edu
    affiliation: AU
  - name: \mbox{Alexander Vinel}
    email: alexander.vinel@auburn.edu
    affiliation: AU
  - name: \mbox{Karen Davis}
    email: davisk4@miamioh.edu
    affiliation: MUCS
  - name: \mbox{Fadel Megahed}
    email: fmegahed@miamioh.edu
    affiliation: MUFSB
  - name: \mbox{Hong Xian}
    email: hong.xian@slu.edu
    affiliation: SLU
  - name: \mbox{Steven E. Rigdon}
    email: steve.rigdon@slu.edu
    affiliation: SLU
    footnote: Corresponding Author
address:
  - code: SLU
    address: Department of Epidemiology and Biostatistics, Saint Louis University, Saint Louis, MO, 63108, United States
  - code: JHU
    address: Carey Business School, Johns Hopkins University, Baltimore, MD, 21218, United States
  - code: AU
    address: Department of Industrial and Systems Engineering, Auburn University, Auburn, AL, 36849, United States
  - code: MUCS
    address: Department of Computer Science and Software Engineering, Miami University, Oxford, OH, 45056, United States
  - code: MUFSB
    address: Department of Information Systems and Analytics, Miami University, Oxford, OH, 45056, United States
abstract: |
  This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. This is an awesome abstract. 
keywords: Trucking, Naturalistic driving studies, Safety-critical events
journal: "Analytic Methods in Accident Research"
csl: analytic-methods-in-accident-research.csl
date: "`r Sys.Date()`"
bibliography: Aim2references.bib
output:
  bookdown::pdf_book:
    base_format: rticles::elsevier_article
geometry: "left=2cm,right=2cm,top=2cm,bottom=2.5cm"
linenumbers: true
link-citations: true
linkcolor: blue
urlcolor: red
header-includes:
  - \usepackage{soulutf8}
  - \usepackage{color}
  - \usepackage{float}
  - \usepackage{subcaption}
  - \usepackage{booktabs}
  - \usepackage{lscape}
  - \usepackage{setspace}
  - \usepackage{dcolumn}
  - \usepackage[utf8]{inputenc}
  - \usepackage{array}
  - \usepackage{makecell}
  - \usepackage[bottom,flushmargin,hang,multiple]{footmisc}
---

\newcommand{\blandscape}{\begin{landscape}}
\newcommand{\elandscape}{\end{landscape}}
\setlength\footskip{1.8cm}
\doublespacing

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, fig.align = "center", 
                      out.width='\\textwidth', fig.pos = 'H')
```


Introduction
============
The World Health Organization [@who2018] estimated that road injury claimed around 1.4 million lives globally in 2016, which was the eighth leading cause of death. Among all types of vehicles on road, large trucks are a concern since they are more frequently involved in catastrophic crashes. In the United States, @nhtsa2017 reported that 4.3% of registered vehicles were large trucks or buses, but they account for 12.4% of fatalities associated with vehicles [@hickman2018synthetic]. Truck drivers are often on the road for long routes under on-time demands, complex traffic and weather conditions, with little to no supervision and contact with fellow workers. Therefore, a number of studies have been published to predict and reduce crash risk associated with trucks [@cantor2010driver; @chen2015hierarchical; @dong2017estimating].

Traditional crash prediction studies collect retrospective reports of crashes in a given road section for a specified time period, match these crash cases with non-crash controls (typically 1 to 4 matching), and then build statistical models, such as logistic regression and neural networks, to study risk factors associated with higher risk of crashes [@blower2010condition; @sharwood2013use; @meuleners2017determinants]. This case-control study design is efficient and less time-consuming in trucking safety field since crashes are very rare. However, case-control studies, by nature, are limited in study design. Firstly, it is impossible to estimate and compare the rate of crashes since the number of non-crashes is unknown. Besides, retrospective reports are often subject to recall and report bias: the drivers may not accurately recall the exact conditions at the time of the event; they may intentionally conceal some critical facts to escape from legal punishment [@dingus2011estimating; @stern2019data].

Naturalistic driving studies (NDSs) have been emerging in the past decade thanks to the advancement of technology. An NDS continuously collects driving data (including latitude, longitude, and speed) under real-world conditions using on-board unobtrusive equipment [@guo2019statistical]. In contrast to retrospective reports, an NDS resembles a cohort study: a pre-determined set of drivers are prospectively followed for a certain amount of time. Therefore, NDS comparatively has several advantages. First, NDS collects both crashes and non-crashes, so it is more useful in comparing the rates of events. Second, since vehicle crashes are extremely rare, it may take a huge amount of driving time to have sufficient sample of crashes. Instead, NDS focus safety-critical events (SCEs), which is defined as events that avoid crashes by last-second evasive maneuver [@dingus2011estimating]. SCEs can be 1000 times as high as real crashes and are argued to be good surrogates of crashes [@guo2010near; @dingus2011estimating]. Third, NDS data are collected using programmed instruments or sensors, therefore they are less likely to be subject to human error or manipulation. Lastly, NDS collects data every a few seconds to minutes, and this large-scale high-resolution data provide a promising opportunity to quantifying driving risk [@guo2019statistical].

However, many issues arise given the characteristics of NDSs. First, the sheer volume of NDS data creates a challenge to data management and aggregation [@mannering2014analytic]. For example, a NDS data set can have billions rows of real-time speeds and locations, and it is important to have scalable and high-performance tools to aggregate these data into units that fit into the framework of statistical modeling. Second, routinely collected NDS data only have vehicle driving data. Crucial environmental variables such as weather and traffic need to be accessed from other sources and merged back to the driving data. Third, even with these data sources, management, and aggregation issues solved, scalable statistical models that account for the characteristics of NDS are needed to analyze the aggregated data.

\hl{A brief review of previous NDS analytic studies.}

With increasing vehicle and insurance companies collecting NDS data on a regular basis, a scalable and generalizable analyzing framework serves as a pattern for follow-up researchers to better understand NDS data and gain insights into transportation safety. In this paper, we proposed a framework for data collection, aggregation, fusing, and statistical modeling, which is demonstrated in a case study. Although the NDS data used in this study were from large commercial truck drivers, the framework is generalizable to other drivers since the data collected among different drivers are similar.

<!--
\hl{Issued raised by NDS. 1. Sparse data, 2. fusing traffic and weather data from other sources, 3. High-dimensional data, 4. Hierarchical structure.}
Bayesian hierarchical models are particularly useful in the case of analyzing truck driver's safety events. Traditional hierarchical models heavily rely on maximum likelihood estimation and restricted maximum likelihood estimation, and it is highly influenced by outliers. In contrast, Bayesian hierarchical models are more robust to extreme values, with properly assigned priors and 'shrinkage towards the mean [@lambert2018student]. In addition, critical events and crashes in transportation safety studies are so rare compared to the non-event cases that the data alone are unable to identify the model. In this sense, prior information is needed to  make valid statistical inference on the data [@betancourt2015hamiltonian]. Finally, Bayesian models can compute the posterior distributions of our desired parameter estimates. The posterior distributions provide credible intervals that have more straightforward interpretation than confidence intervals in Frequentist models. 
-->




Data
====
The data were collected by a leading freight shipping trucking company (we will name it as Company A for confidentiality reasons) in the United States. From April 2015 to March 2016, Company A installed in-vehicle data acquisition systems (DAGs) to all their trucks, which collect real-time *ping* and *SCEs* data. For demonstration purposes, we selected 496 regional drivers who move freights in a region that can include surrounding states. Apart from these vehicle driving data, demographic variables including age, gender, and race were also provided by Company A. The names of the drivers were not provided to the research team to ensure confidentiality, while a unique identification number was provided for each driver to link the three data sources. The study protocol was reviewed and approved by the Institutional Review Board of Saint Louis University.

ping and SCEs data
------------------
Every a couple of seconds to minutes, the DAG collects the date and time (year, month, day, hour, minute, and second), latitude and longitude (specific to five decimal places), driver identity number, and speed at that second. In total, 13,187,289 pings were provided to the research team. 

```{r eval=FALSE}
pacman::p_load(data.table, dplyr)
d = fst::read_fst("data/cleaned/11ping_add_trip_shift_id.fst") %>% 
  as.data.table()
d
```


SCEs. Besides, the company also regularly collected real-time GPS location and time-stamped critical events data for all their trucks. There were 12,458 critical events occurred to these 498 truck drivers during the study period. Four types of critical events were recorded in this critical events data. \hl{The number of SCEs.}

Weather
-------
Apart from driver's characteristics and driving condition, weather also poses a threat on truck crashes and injuries [@zhu2011comprehensive; @naik2016weather; @uddin2017truck]. We obtained historic weather data from the DarkSky Application Programming Interface (API), which allows us to query real-time and hour-by-hour nationwide historic weather conditions according to latitude, longitude, date, and time [@darksky]. The variables included visibility, precipitation probability^[Ideally, historic precipitation at a specific location and time should be yes or not. However, in reality, since the weather stations are distributed not densely enough to record the exact weather conditions in every latitude and longitude in the US, the DarkSky API uses their algorithms to infer the probability of precipitation in each location.] and intensity, temperature, wind and others.

Other available sources
-----------------------
Traffic and road geometry can be collected from Google map API and OpenStreet API.

<!--
Innovation
----------

1. Data aggregation and analytic framework,
2. Fusing NDS data and API data,
3. A subsampling framework for large-scale Bayesian hierarchical models
-->

Data preparation
================
Data aggregation
----------------
```{r dataagg, fig.cap='Data aggregation process from pings to shifts, trips, and 30-minute intervals.'}
knitr::include_graphics("figures/ping_data_aggregation.pdf")
```

To shrink the large size of over 10 million ping data, we rounded the GPS coordinates to the second decimal places, which are worth up to 1.1 kilometers, and we also round the time to the nearest hour. We then queried weather variables from the DarkSky API using the approximated latitudes, longitudes, date and hour. The weather variables used in this study include precipitation probability, precipitation intensity, and visibility.

For each of the truck drivers, if the ping data showed that the truck was not moving for more than 20 minutes, the ping data were separated into two different trips. These ping data were then aggregated into different trips. A **trip** is therefore defined as a continuous period of driving without stop. As Table  demonstrates, each row is a trip. The average length of a trip in this study is 2.31 hours with the standard deviation of 1.8 hours.

After the ping data were aggregated into trips, these trips data were then further divided into different shifts according to an eight-hour rest time for each driver. A **shift** is defined as a long period of driving with potentially less than 8 hours' stops. The Shift_ID column in  shows different shifts, separated by an eight-hour threshold. The average length of a shift in this study is 8.42 hours with the standard deviation of 2.45 hours.

Cumulative driving time as a measure of fatigue
-------------------
Fatigue has been reported to be the most important predictor to truck crashes, considering that truck drivers are exposed to long routes and lone working environment @stern2019data.

Driver's fatigue is difficult to measure in real life. In this study, we attempt to use three proxies to measure the fatigue of the truck drivers: cumulative driving time in a shift, the rest time before a shift, and the rest time before a trip.



Methodology
=======
Statistical models
------------------
Traditional statistical models assume that observations are independent from each other given their predictor variables. However, natural data are almost never independent given the predictor variables. In the example of truck driver's safety events, if we assume the external traffic, weather and driver's socioeconomic status are fixed, truck drivers may exhibit similar driving patterns in multiple trips, and then drivers hired by the same company may share similar culture and safety atmospheres. Therefore, traffic accidents are naturally nested within drivers and drivers are nested within companies. Traditional statistical models that assume independence between observations are not appropriate in this case since objects tend to be similar within a group. Hierarchical models, also known as multilevel model, random-effects model or mixed model, have been developed to allow for the nested nature of data. Instead of assuming independence given predictor variables, hierarchical models assume conditional independence. Hierarchical models are advocated to be the default method since they can produce more precise prediction and more robust results than traditional models.

Random-effects models [@han2018investigating; @pantangi2019preliminary].

Here we model the probability of a critical event occurred using a Bayesian hierarchical Bernoulli regression. We categorized the number of safety events during a trip into a binary variable $Y$ with the value of either 0 or 1, where 0 indicated that no critical event occurred during that trip while 1 indicated that at least 1 critical event occurred during the trip. Since each trip $i$ has a different travel time $t_i$, we derived the Bernoulli distribution parameter $p_i$ using the probability density function of the Poisson distribution, with the parameter $\lambda_i$ equaled a linear combination of $\beta_i$ and $x_i$.
\begin{align}
	\label{bernp}
	\begin{split}
		P_i & = P(\text{at least one event in trip i})\\
		& = 1 - P(\text{no event in trip i})\\
		& = 1 - \frac{e^{-t_i\lambda_i}(t_i\lambda_i)^0)}{0!}\\
		& = 1 - \exp(-t_i\lambda_i)\\
		& = 1 - \exp(-t_ie^{\beta_0 + \beta_ix_i})
	\end{split}
\end{align}
Transform that into a linear function of $\beta_i, x_i$ and $t_i$
\begin{align}
	\label{transform}
	\begin{split}
		1 - P_i & = \text{EXP}(-t_ie^{\beta_0 + \beta_ix_i})\\
		\log(1 - P_i) & = -t_ie^{\beta_0 + \beta_ix_i}\\
		\log\frac{1}{1 - P_i} & = e^{\beta_0 + \beta_ix_i + \log(t_i)}\\
		\log\Big(\log\frac{1}{1 - P_i}\Big) & = \beta_0 + \beta_ix_i + \log(t_i)
	\end{split}
\end{align}
Then, the random effects logistic model is
\begin{align}
	\label{logis}
	\begin{split}
		Y_i & \sim \text{Bern}(P_i)\\
		\log\Big(\log\frac{1}{1 - P_i}\Big)  & = \beta_{0, d(i)} + \beta_{1, d(i)} \cdot \text{CT}_i + \mathbf{\xi} \cdot \mathbf{W} + \mathbf{\nu} \cdot \mathbf{D_i} + \log(t_i)
	\end{split}
\end{align}

Here the trip is indexed by $i$, $Y_i$ is the binary outcome variable of whether at least one critical event occurred in trip $i$; $d(i)$ is the driver for trip $i$, $\beta_{0, d(i)}$ is the random intercept for driver $d(i)$; $\beta_{1, d(i)}$ is the random slope for the cumulative time (CT$i$) of driving in the shift (the sum of driving time for all previous trips) for driver $d(i)$; $\mathbf{W}$ is a vector of external environment fixed effects, including precipitation intensity and probability, visibility, and whether it was sunrise or sunset time; $\mathbf{D}_i$ are driver level fixed effects, including age group and business unit; $t_i$ is the travel time for the trip $i$.

We assume that the drivers are random effects, and we assume exchangeable priors of the form
\[
\beta_{0, d(1)}, \beta_{0, d(2)}, \ldots , \beta_{0, d(n)} \sim \text{i.i.d.} N(\mu_0,\sigma_0^2)
\]
and 
\[
\beta_{1, d(1)}, \beta_{1, d(2)}, \ldots , \beta_{1, d(n)} \sim \text{i.i.d.} N(\mu_1,\sigma_1^2)
\]
The parameters $\mu_0, \sigma_0, \mu_1$, and $\sigma_1$ are hyperparameters with priors. Since we do not have much prior knowledge on the hyperparameters, we assigned diffuse priors for these hyperparameters.
\begin{align}
	\label{prior}
	\begin{split}
		\mu_0 & \sim N(0, 10^2)\\
		\mu_1 & \sim N(0, 10^2)\\
		\sigma_0 & \sim \text{GAMMA}(1, 1)\\
		\sigma_1 & \sim \text{GAMMA}(1, 1)
	\end{split}
\end{align}
Since $\mu_0$ and $\mu_1$ can be any real number, so we assigned two normal distributions with mean of 0 and standard deviation of 10 as the priors for these two hyperparameters. In comparison, $\sigma_0$ and $\sigma_1$ must be strictly positive, so we assigned GAMMA$(1, 1)$ with wide distribution on positive real numbers as their priors.






Results
=======

```{r fig.cap="The rate of safety critical events and cumulative driving time",out.width = "\\textwidth"}
knitr::include_graphics("figures/p_11hours.png")
```


Discussion
==========


Conclusions
=================
Subsampling MCMC [@quiroz2016block; @quiroz2018speeding; @dang2019hamiltonian; @quiroz2019speeding].

Acknowledgement {-}
===============
This work was supported in part by the National Science Foundation (CMMI-1635927 and CMMI-1634992), the Ohio Supercomputer Center (PMIU0138 and PMIU0162), the American Society of Safety Professionals (ASSP) Foundation, the University of Cincinnati Education and Research Center Pilot Research Project Training Program, and the Transportation Informatics Tier I University Transportation Center (TransInfo). We also thank the DarkSky company for providing us five million free calls to their historic weather API.

References {#references .unnumbered}
==========
